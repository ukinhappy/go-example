package main

import (
	"fmt"
	"github.com/gomodule/redigo/redis"
	"strings"
	"time"
)

// dial dials connections then returns pool.
func dial(addr, pw string) *redis.Pool {
	dialOptions := []redis.DialOption{
		redis.DialConnectTimeout(time.Second),
		redis.DialReadTimeout(time.Second),
		redis.DialWriteTimeout(time.Second),
	}
	if pw != "" {
		dialOptions = append(dialOptions, redis.DialPassword(pw))
	}
	return &redis.Pool{
		Dial: func() (redis.Conn, error) {
			c, err := redis.Dial("tcp", addr, dialOptions...)
			if err != nil {
				return nil, err
			}

			return c, nil
		},
		MaxIdle:     1000,
		MaxActive:   1000,
		IdleTimeout: time.Second * 100,
	}
}

func main() {
	//lua()
	//snowflake()
	//incrlua()
	t1()
}

var str = `20104032,20104025,20104023,20104035,20104024,20104036,20104027,20104026,20104038,20104028,20104029,20104031,20104030,20104039,20099482,20104034,20104037,20104033,20104040,20104044,20104045,20104047,20104046,20104049,20104048,20104050,20104051,20104043,20104042,20104055,20104059,20104054,20104058,20104053,20104057,20104060,20104052,20104056,20104068,20104069,20104070,20104071,20104072,20104065,20104066,20104067,20104062,20104063,20104064,20104075,20104079,20104074,20104078,20104077,20104073,20104076,20104080,20104082,20104085,20104087,20104084,20104086,20104088,20104089,20104090,20104091,20104099,20104095,20104098,20104094,20104097,20104093,20104100,20104096,20104092,20104106,20104109,20104105,20104107,20104104,20104108,20104110,20104102,20104103,20104115,20104119,20104111,20104114,20104118,20104113,20104117,20104120,20104116,20104112,20104128,20104129,20104130,20104122,20104124,20104123,20104125,20104127,20104126,20104138,20104139,20104135,20104131,20104134,20104137,20104133,20104136,20104132,20104140,20104152,20104143,20104142,20104144,20104147,20104148,20104145,20104146,20104149,20104150,20104151,20104159,20104155,20104158,20104154,20104157,20104153,20104160,20104156,20104166,20104165,20104167,20104164,20104168,20104169,20104170,20104162,20104163,20104175,20104171,20104179,20104174,20104178,20104173,20104177,20104172,20104180,20104176,20104189,20104190,20104188,20104184,20104183,20104182,20104185,20104187,20104186,20104199,20104195,20104191,20104198,20104194,20104197,20104193,20104196,20104200,20104192,20104202,20104204,20104203,20104205,20104206,20104207,20104209,20104208,20104210,20104211,20104219,20104215,20104218,20104214,20104217,20104213,20104220,20104216,20104212,20104224,20104227,20104225,20104228,20104229,20104226,20104230,20104222,20104223,20104235,20104231,20104239,20104234,20104238,20104233,20104237,20104232,20104240,20104236,20104249,20104250,20104248,20104243,20104244,20104242,20104245,20104246,20104247,20104259,20104255,20104251,20104258,20104254,20104257,20104253,20104256,20104252,20104260,20104262,20104263,20104269,20104265,20104264,20104270,20104267,20104266,20104268,20104279,20104271,20104275,20104278,20104274,20104277,20104273,20104280,20104276,20104272,20104285,20104286,20104287,20104284,20104288,20104289,20104290,20104282,20104283,20104295,20104291,20104299,20104294,20104298,20104293,20104297,20104292,20104300,20104296,20104308,20104309,20104310,20104302,20104304,20104303,20104305,20104306,20104307,20104319,20104315,20104311,20104318,20104314,20104317,20104313,20104316,20104312,20104320,20104322,20104324,20104325,20104326,20104323,20104328,20104329,20104327,20104330,20104331,20104339,20104335,20104338,20104334,20104337,20104333,20104340,20104336,20104332,20104344,20104349,20104348,20104345,20104347,20104350,20104346,20104343,20104342,20104355,20104359,20104351,20104354,20104358,20104353,20104357,20104360,20104356,20104352,20104369,20104368,20104370,20104363,20104364,20104362,20104365,20104377,20104366,20104367,20104379,20104375,20104371,20104378,20104374,20104373,20104376,20104372,20104380,20104382,20104384,20104387,20104383,20104386,20104385,20104389,20104388,20104400,20104390,20104391,20104395,20104399,20104398,20104394,20104397,20104393,20104396,20104392,20104404,20104405,20104406,20104408,20104407,20104409,20104410,20104402,20104403,20104415,20104411,20104419,20104414,20104418,20104413,20104417,20104412,20104420,20104416,20106371,20106373,20106374,20106377,20106375,20106376,20106378,20106380,20106379,20106381,20106383,20106391,20106387,20106382,20106390,20106386,20106389,20106385,20106388,20106384,20106397,20106396,20106398,20106399,20106400,20106393,20106401,20106394,20106395,20106407,20106411,20106403,20106406,20106402,20106410,20106405,20106409,20106404,20106408,20106420,20106421,20106413,20106416,20106415,20106414,20106417,20106418,20106419,20106431,20106427,20106423,20106430,20106426,20106422,20106429,20106425,20106428,20106424,20106433,20106434,20106436,20106435,20106437,20106438,20106440,20106439,20106441,20106443,20106451,20106447,20106442,20106450,20106446,20106449,20106445,20106448,20106444,20106461,20106458,20106457,20106459,20106456,20106472,20106460,20106462,20106454,20106455,20106467,20106471,20106463,20106466,20106470,20106465,20106469,20106468,20106464,20104083,46503133,45298284,20121903,20051046,20121703,20051047,20051045,45898993,45298291,45898994,45898946,45898945,45898944,45898948,45298274,45898956,45298248,45898949,45898952,45898950,45898951,45898953,45898954,45898963,45898959,45898962,45898958,45898957,45898961,45898964,45898960,20191117,20191120,20191119,20191122,20191123,20191118,20191121,20191112,20191124,20191126,20191114,20189699,20191127,20191115,20191113,20191125,20191128,20189700,20191116,20191140,20191130,20191132,20191144,20191135,20191134,20191146,20191133,20191145,20191131,20191136,20191148,20191137,20191138,20191139,20191143,20191147,20191142,20191141,20191153,20191152,20191164,20191157,20191154,20191155,20191156,20191159,20191158,20191160,20191151,20191150,20191163,20191167,20191162,20191166,20191161,20191165,20191168,20191177,20191176,20191180,20191178,20191171,20191170,20191173,20191172,20191184,20191174,20191175,20191187,20191183,20191179,20191186,20191182,20191185,20191181,20191188,20191200,20191191,20191195,20191192,20191204,20191190,20191193,20191194,20191196,20191208,20191198,20191197,20191199,20191207,20191203,20191206,20191202,20191205,20191201,20296392,20296380,20296382,20296381,20296393,20296383,20296384,20296385,20296386,20296387,20296388,20296389,20191209,20296378,20296390,20296379,20296391,20296377,20296376,20296396,20296403,20296411,20296399,20296407,20296402,20296398,20296410,20296406,20296401,20296413,20296409,20296397,20296405,20296408,20296395,20296412,20296400,20296404,20296427,20296423,20296419,20296426,20296422,20296418,20296733,20296421,20296425,20296416,20296735,20296429,20296736,20296417,20296424,20296420,20296415,20296734,20296428,20296739,20296751,20296747,20296743,20296750,20296755,20296738,20296746,20296754,20296742,20296749,20296753,20296741,20296745,20296756,20296744,20296748,20296752,20296740,20296763,20296775,20296771,20296767,20296762,20296774,20296770,20296758,20296766,20296773,20296761,20296769,20296765,20296760,20296772,20296768,20296759,20296776,20296764,20041452,20041457,20041441,20041448,20041454,20041442,20041447,20041459,20041451,20041455,20041450,20041449,20041453,20041445,20041444,20041456,20041766,20041776,20041765,20041771,20041759,20041760,20041762,20041761,20041775,20041763,20041767,20041770,20041758,20041773,20041769,20041764,20041446,44898020,44497270,44497271,44497311,44898106,44898104`

func t() {

	uids := strings.Split(str, ",")

	d := dial("172.16.1.112:7004", "").Get()
	for i := 0; i < 41; i++ {
		fmt.Println(d.Do("zadd", "im:voice:p:an:u:20201211:45298372", 11607485108, uids[i]))
	}

	d = dial("172.16.1.112:7000", "").Get()
	for i := 0; i < 50; i++ {
		fmt.Println(d.Do("zadd", "im:voice:p:an:u:20201211:45298333", 11607485108, uids[i]))
	}
}

func t1() {
	d := dial("172.16.1.202:6000", "123456.com").Get()
	uids, _ := redis.Strings(d.Do("lrange", "potential_member20201210", 0, -1))
	var allUid []string
	uidmap := make(map[string]bool, 0)
	for _, uid := range uids {
		if uidmap[strings.Split(uid, ",")[0]] {
		continue
		}
		uidmap[strings.Split(uid, ",")[0]] = true
		allUid = append(allUid, strings.Split(uid, ",")[0])
	}

	fmt.Println(strings.Join(allUid, ","))
}
